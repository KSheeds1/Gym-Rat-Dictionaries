{% extends "base.html" %}
{% block content %}
    
    <!--Search functionality-->
    <div class="row card-panel search-panel black">
        <form action="{{ url_for('search') }}" method="POST" class="col s12">
            <div class="row valign-wrapper center-align">
                <div class="input-field col s12 m8">
                    <i class="fas fa-search prefix pink-text"></i>
                    <input type="text" name="query" id="query" minlength="3" class="validate white-text" required>
                    <label for="query">Search Definitions or Categories</label>
                </div>
                <div class="col s12 m4">
                    <button type="submit" class="btn search"><i class="fas fa-search left white-text"></i>Search</button>
                    <a href="{{ url_for('get_definitions') }}" class="btn reset white-text">Reset</a>
                </div>
            </div>
        </form>
    </div>


    <!--Definitions card panel-->
    {% if definitions.count() > 0 %}
    <h3 class="center-align">Recently added</h3>
    <div class="divider"></div>

    <div class="row">
        {% for definition in definitions %}
            <div class="col s12 m6">
                <div class="card grey z-depth-5">
                    <div class="card-content black-text">
                        <strong class="card-title">{{ definition.exercise_name }}  
                            <a href="{{ url_for('add_to_favourites', definition_id=definition._id) }}" class="tooltipped" data-position="right" data-tooltip="Add definition to Bookmarks">
                                <i class="fas fa-bookmark right"></i></a>
                            <a class="modal-trigger right tooltipped" data-target="#modal1{{ definition._id }}" 
                                data-position="right" data-tooltip="Share Definition"><i class="fas fa-share-alt fa-lg"></i></a></strong>
                        <div class="divider black"></div>
                        <p class="defintion">{{ definition.exercise_description }}</p>
                        <p class="tempo">Tempo: {{ definition.tempo }}</p>
                        <p class="image_url">{{ definition.image_url }}</p>
                        <p class="created_by"><i class="fas fa-user"></i><em> {{ definition.created_by }}</em></p>
                    </div>
                    <div class="card-action">
                        <a href="{{ url_for('upvote', definition_id=definition._id) }}" class="add btn-small tooltipped"
                            data-position="right" data-tooltip="Upvote this definition"><i class="fas fa-thumbs-up"> {{ definition.upvote }}</i></a>
                        <a href="{{ url_for('downvote', definition_id=definition._id) }}" class="add btn-small tooltipped" 
                            data-position="right" data-tooltip="Downvote this definition"><i class="fas fa-thumbs-down"> {{ definition.downvote }}</i></a>
                        {% if session.user|lower == definition.created_by|lower or session.user|lower == "admin"|lower and session.user|lower == definition.created_by|lower %}
                            <a href="#modal2" data-target="#modal2{{ definition._id }}" class="modal-trigger btn delete right"><i class="far fa-trash-alt"></i> Delete</a>
                            <a href="{{ url_for('edit_definition', definition_id=definition._id) }}" class="btn edit right">
                                <i class="far fa-edit"></i> Edit</a>
                        {% elif session.user|lower == "admin"|lower %}
                            <a href="{{ url_for('delete_definition', definition_id=definition._id) }}"
                                class="btn delete right"><i class="far fa-trash-alt"></i> Delete</a>
                        {% endif %}
                    </div>
                </div>
            </div>
                <!--Share definition modal-->
                <div id="#modal1{{ definition._id }}" class="modal">
                    <div class="modal-header">
                        <h4>Share this definition?</h4>
                    </div>
                    <div class="modal-content">
                        <ul class="share-def-socials center-align">
                            <li><a class="text-shadow" href="https://www.facebook.com/" target="_blank" title="Share definition on Facebook" rel="noopener"><i
                                        class="fab fa-facebook-f fa-3x"></i></a></li>
                            <li><a class="text-shadow" href="https://www.tiktok.com/" target="_blank" title="Share definition on TikTok" rel="noopener"><i
                                        class="fab fa-tiktok fa-3x"></i></a></li>
                            <li><a class="text-shadow" href="https://www.instagram.com/" target="_blank" title="Share definition on Instagram" rel="noopener"><i
                                        class="fab fa-instagram fa-3x"></i></a></li>
                            <li><a class="text-shadow" href="https://www.youtube.com/" target="_blank" title="Share definition on YouTube" rel="noopener"><i
                                        class="fab fa-youtube fa-3x"></i></a></li>
                        </ul>
                    </div>
                    <div class="divider black"></div>
                    <div class="modal-footer">
                        <a class="modal-close btn">Cancel</a>
                    </div>
                </div>
                <!-- User confirmation modal for definition deletion -->
                <div id="#modal2{{ definition._id }}" class="modal">
                    <div class="modal-header">
                        <h4>Delete this definition?</h4>
                    </div>
                    <div class="modal-content">
                        <p><em>Are you sure you want to delete this definition?</em></p>
                    </div>
                    <div class="divider black"></div>
                    <div class="modal-footer">
                        <a href="{{ url_for('delete_definition', definition_id=definition._id) }}" class="btn delete">Delete</a>
                        <a class="modal-close waves-effect waves-green btn-flat">Cancel</a>
                    </div>
                </div>
        {% endfor %}
    </div>
    {% else %}
        <h3 class="center-align">Sorry, no results found!</h3>
    {% endif %}
    <div class="pagination-section center-align">
        {% if definitions.count() > 0 %}
            {{ pagination.links }}
        {% endif %}
    </div>       

{% endblock %}
